(function(b){var a=b("#video-wrapper");b.fn.additionalContentLoader=function(e){var g=e.indexOf("-"),c=g>0?e.substring(0,g):e,f="fragments/"+c+".html",d=b("#additional-content-wrapper").addClass("loading").removeClass("hidden");d.children("div").empty().load(f,function(){d.removeClass("loading");document.location.hash="#"+e})};b.fn.videoControlsDisplay=function(k){var g=0,l=0,h=this,e=b("div.video-controls",h),d=function(){e.addClass("opacity-zero");h.addClass("no-cursor")},j=function(){e.removeClass("opacity-zero");h.removeClass("no-cursor")},c=function(m){if(++l>2){l=0;window.clearTimeout(g);j();g=window.setTimeout(d,2000)}},f=function(m){h.off("mousemove",c);window.clearTimeout(g);j()},i=function(m){window.clearTimeout(g);g=window.setTimeout(d,2000);h.on("mousemove",c)};switch(k){case"hide":d();h.on("mousemove",c);e.on("mouseleave focusout",i).on("mouseenter focusin",f);return;case"show":default:if(jQuery.isNumeric(g)){window.clearTimeout(g)}h.off("mousemove",c);e.off("mouseleave focusout",i).off("mouseenter focusin",f);j();return}};b.fn.videoInfoControl=function(f){var e=this,d=b("div.video-info",e),c=function(g){e.videoControl("play");g.preventDefault();g.stopPropagation()};if(f){d.removeClass("hidden");e.on("click","a.play",c)}else{d.addClass("hidden");e.off("click","a.play",c)}};b.fn.videoControl=function(c,f,g){var h=this,d=b("div.video-poster",h),e=b("video",h);e.each(function(){var k=this,i=0,j=b(k).parentsUntil("#video-wrapper","article");if(f){i=jQuery.isNumeric(g)?g:k.currentTime}switch(c){case"play":j.videoInfoControl(false);d.addClass("hidden");k.currentTime=i;k.play();h.videoControlsDisplay("hide");j.videoControlsMenu("start").videoControlsTimeline("start");break;case"replay":k.currentTime=i;k.play();j.videoControlsMenu("reset");break;case"stop":j.videoInfoControl(false);d.removeClass("hidden");k.pause();j.videoControlsMenu("stop").videoControlsTimeline("stop");break;case"pause":k.pause();break;case"fullscreen":if(document.fullscreen||document.mozFullScreen||document.webkitFullScreen||document.webkitIsFullScreen||(document.fullscreenElement&&document.fullscreenElement!==null)){if(document.cancelFullscreen){document.cancelFullscreen()}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}}break}if(j[0].requestFullscreen){j[0].requestFullscreen()}else{if(j[0].mozRequestFullScreen){j[0].mozRequestFullScreen()}else{if(j[0].webkitRequestFullScreen){j[0].webkitRequestFullScreen()}}}break;default:console.log("VideoController, action unknown: "+c);break}});return this};b(function(){var c=function(e){var f=this.id.charAt(this.id.length-1),g=b("#video-col-"+f,a),d=b("div.column",a);if(!g.hasClass("opened-column")){a.videoControl("stop");b(this).videoInfoControl(true);g.addClass("opened-column").removeClass("closed-column");d.not(g).addClass("closed-column").removeClass("opened-column")}};a.on("click","article",c)});b(function(){var g="div.related-videos",f,d=function(i){var h=b(i.target),j=h.next(g).removeClass("hidden");f=window.setTimeout(function(){var k=h.parents("article").next();if(k.length>0){k.trigger("click")}else{b("#video-1").trigger("click")}},9000)},e=function(i){var h=b(i.target),j=h.next(g).addClass("hidden")},c=function(h){window.clearTimeout(f);var j=h.currentTarget.hash,i=h.currentTarget.className;switch(i){case"replay":b(j).videoControl("replay",true,0);case"another":b(j).trigger("click");break;case"expert":b.fn.additionalContentLoader("experts");return}h.preventDefault();h.stopPropagation()};b("video",a).on("ended",d).on("play",e);a.on("click",g+" a",c)});b.fn.videoControlsTimeline=function(d){var f=this,c=b("div.video-controls",f),e=function(h){var g=b(h.target),i=g.data("sequence-time");f.videoControl("replay",true,i);h.preventDefault();h.stopPropagation()};switch(d){case"start":c.on("click","ol a",e);return f;case"stop":default:c.off();return f}};b.fn.videoControlsMenu=function(e){var i=this,d=b("div.video-controls",i),c=b("a.play-pause",d),g=function(j){if(j===true){c.addClass("play").removeClass("pause").text("pause")}else{c.addClass("pause").removeClass("play").text("lecture")}},h=function(j){i.videoControl("fullscreen");j.preventDefault();j.stopPropagation()},f=function(k){var j=c.hasClass("pause");if(j){i.videoControl("replay",true)}else{i.videoControl("pause")}g(j);k.preventDefault();k.stopPropagation()};switch(e){case"start":g(true);d.on("click","a.play-pause",f).on("click","a.fullscreen",h);return i;case"reset":g(true);return i;case"stop":default:d.off();g(false);return i}};b(function(){var e=function(g){var f=g.replace(/^#\/?/,"");console.log(f);switch(f){case"experts-podologie":case"experts-psychologie":case"experts":case"makingoff":case"credits":case"flickr":console.log("+"+f);b("article",a).videoControl("stop");b("div.column",a).removeClass("closed-column opened-column");b.fn.additionalContentLoader(f);return false;case"video-1":case"video-2":case"video-3":case"video-4":case"video-5":b("#"+f).trigger("click");return true;case"top":default:b("article",a).videoControl("stop");b("div.column",a).removeClass("closed-column opened-column");return false}},c=function(f){var g=f.target.hash.substr(1);if(e(g)){f.preventDefault();f.stopPropagation()}},d=b("#primary-menu, footer nav").on("click","a",c);e(document.location.hash)});b(function(){var c=b("#primary-menu").affix({offset:96})});b(function(){b(window).on("hashchange",function(c){var d=location.hash.replace(/^#\/?/,"");if(document.getElementById(d)){b.smoothScroll({scrollTarget:"#"+d,offset:-32,speed:200})}});b(window).trigger("hashchange")})})(jQuery);
